# AGENTS.md — Сервис навигации по лекциям

Этот документ описывает сервис, который предоставляет удобную навигацию по учебным лекциям (видео/текст/конспекты) и связанным материалам. Он предназначен как ориентир для разработки, интеграций и согласования требований.

---

## 1) Цель продукта

Сервис позволяет:
- хранить лекции и материалы к ним (текстовые конспекты, шпаргалки, ссылки, файлы);
- быстро находить нужный фрагмент по теме/ключевым словам;
- проходить курс по структуре «курс → модуль → лекция → разделы»;
- отслеживать прогресс и возвращаться к отмеченным местам.

Главная ценность: **навигация** — пользователь не “листает” длинные тексты и не перематывает видео вслепую, а переходит к нужной лекции/разделу в 1–2 клика.

---

## 2) Пользовательские сценарии (User Stories)

1. **Студент**
   - хочу видеть список лекций и их структуру (модули, темы),
   - хочу открыть лекцию и перейти к конкретному разделу,
   - хочу искать по всем лекциям (по терминам, заголовкам, коду),
   - хочу отмечать «важное» и возвращаться к нему.

2. **Преподаватель/автор курса**
   - хочу загрузить новые лекции (текст/ссылку на видео),
   - хочу разбить лекцию на разделы/таймкоды,
   - хочу добавить теги/уровень сложности/домашку,
   - хочу обновлять лекцию без поломки ссылок.

3. **Администратор/контент-менеджер**
   - хочу управлять курсами, модулями, доступами,
   - хочу видеть статистику использования (поиск, популярные разделы).

---

## 3) Основные сущности (Data Model)

### Course (Курс)
- `id`, `title`, `description`
- `language`, `level` (beginner/intermediate/advanced)
- `createdAt`, `updatedAt`

### Module (Модуль)
- `id`, `courseId`, `title`, `order`

### Lecture (Лекция)
- `id`, `moduleId`
- `title`, `order`
- `sourceType`: `video | text | mixed`
- `videoUrl?`
- `duration?` (если видео)
- `status`: `draft | published | archived`
- `createdAt`, `updatedAt`

### LectureSection (Раздел лекции)
- `id`, `lectureId`
- `title`, `order`
- `startTimeSec?`, `endTimeSec?` (для видео)
- `contentMarkdown` (текст раздела, конспект, примеры)
- `anchors` (slug/якоря для deep-link)

### Tag (Тег)
- `id`, `name`, `slug`

### LectureTag (Связь)
- `lectureId`, `tagId`

### UserProgress (Прогресс)
- `userId`, `lectureId`
- `lastSectionId?`, `lastTimeSec?`
- `completed: boolean`, `completedAt?`

### Bookmark / Highlight (Закладки/выделения)
- `id`, `userId`, `lectureId`, `sectionId?`
- `note?` (короткий комментарий/подпись к закладке)
- `createdAt`

### Note (Заметка)
- `id`, `userId`, `lectureId`
- `sectionId?` (если привязано к разделу)
- `timeSec?` (если привязано к видео-таймкоду)
- `title?`, `content` (Markdown/plain text)
- `createdAt`, `updatedAt`

---

## 4) Ключевые функции сервиса

### 4.1 Каталог и навигация
- Дерево: **Курс → Модуль → Лекция**.
- У лекции: оглавление (TOC) по `LectureSection`.
- Навигация внутри лекции:
  - «Следующий/предыдущий раздел»
  - «Следующая/предыдущая лекция»
  - breadcrumbs: `Course / Module / Lecture / Section`

### 4.2 Поиск
- Полнотекстовый поиск по:
  - названиям лекций/разделов,
  - содержимому Markdown,
  - тегам.
- Выдача показывает:
  - совпадение с подсветкой,
  - ссылку сразу на **конкретный раздел** (deep-link),
  - для видео — переход по таймкоду.

Рекомендуемо: индексировать контент (например, Postgres FTS / Meilisearch / OpenSearch).

### 4.3 Структурирование лекций
- Разбиение лекций на разделы (ручное или полуавтоматическое).
- Для видео: хранить таймкоды разделов, чтобы клик по разделу перематывал плеер.

### 4.4 Материалы и «шпаргалки»
- Внутри лекции: вкладки/блоки:
  - «Конспект»
  - «Шпаргалка»
  - «Примеры кода»
  - «Домашнее задание»
  - «Ссылки»

### 4.5 Прогресс, закладки и заметки
- Автосохранение последнего места.
- Кнопки: «В избранное», «Закладка», «Отметить важное».
- **Заметки (Notes):** пользователь может добавлять текстовые заметки:
  - к лекции целиком;
  - к конкретному разделу (`sectionId`);
  - к таймкоду видео (`timeSec`), если лекция с видео.
- Страницы: «Мои закладки» и **«Мои заметки»** (или единая страница «Закладки и заметки»).

---

## 5) Страницы и UI (предлагаемая структура)

1. **/courses**
   - список курсов, фильтры (уровень, язык).

2. **/courses/:courseId**
   - описание, список модулей.

3. **/courses/:courseId/modules/:moduleId**
   - список лекций с порядком, статусом «пройдено/не пройдено».

4. **/lectures/:lectureId**
   - левая колонка: оглавление + список лекций модуля (быстрая навигация),
   - центр: контент (разделы),
   - справа: «Поиск по лекции», «Закладки», «Теги».
   - если видео: плеер + таймкоды разделов.

5. **/search?q=...**
   - результаты по всем лекциям/разделам.

6. **/me/progress**
   - прогресс по курсам, продолжить с места.

7. **/me/bookmarks**
   - закладки и заметки.

---

## 6) Deep-links и устойчивые ссылки

- Ссылки должны открывать **точно нужный раздел**:
  - `/lectures/:lectureId#section-<slug>`
- Для видео дополнительно:
  - `/lectures/:lectureId?t=123` (секунды)
- При переименованиях:
  - сохранять стабильные `id`,
  - обновлять `slug`, но поддерживать редирект по старым slug (опционально).

---

## 7) API (высокоуровневые эндпоинты)

### Публичное чтение (для UI)
- `GET /api/courses`
- `GET /api/courses/:id`
- `GET /api/modules?courseId=...`
- `GET /api/lectures?moduleId=...`
- `GET /api/lectures/:id`
- `GET /api/lectures/:id/sections`
- `GET /api/search?q=...`

### Пользовательские данные
- `GET /api/me/progress`
- `POST /api/me/progress` (сохранить last position)
- `GET /api/me/bookmarks`
- `POST /api/me/bookmarks`
- `DELETE /api/me/bookmarks/:id`

### Админ (контент)
- `POST /api/admin/lectures`
- `PATCH /api/admin/lectures/:id`
- `POST /api/admin/lectures/:id/sections`
- `PATCH /api/admin/sections/:id`
- `POST /api/admin/tags`

---

## 8) Нефункциональные требования

### Производительность
- Быстрая навигация: **< 200–300 мс** на переключение разделов при кэшировании.
- Пагинация/ленивая загрузка длинных лекций (если > N разделов).

### Надёжность
- Версионирование контента (минимум — история изменений лекции).
- Бэкапы данных.

### Безопасность
- Роли: `viewer`, `editor`, `admin`.
- Ограничение доступа к черновикам (`draft`) и приватным курсам.
- Защита API (JWT/сессии, rate limiting).

### Доступность и UX
- Навигация с клавиатуры (стрелки/горячие клавиши: next/prev).
- Поддержка мобильных экранов.
- Подсветка текущего раздела в оглавлении.

### i18n
- Тексты и метаданные лекций могут быть на разных языках.
- UI готов к локализации.

---

## 9) Наблюдаемость (Observability)
Логи/метрики:
- события поиска (query, кол-во результатов, клики),
- время загрузки лекции/раздела,
- популярные лекции/разделы,
- ошибки рендера Markdown / плеера.

---

## 10) Роадмап (MVP → Next)

### MVP
- Курсы/модули/лекции/разделы
- Оглавление + next/prev
- Поиск (минимум FTS)
- Прогресс (last position)
- Закладки

### Далее
- Автогенерация структуры (таймкоды/заголовки) из транскрипта
- Рекомендации «что дальше»
- Статистика для преподавателя
- Импорт/экспорт (Markdown, PDF)

---

## 11) Definition of Done (DoD)
Фича считается готовой, если:
- есть UI + API + тесты (хотя бы unit на критичную логику),
- deep-link работает,
- учтены права доступа,
- есть минимальная аналитика (event tracking),
- документация обновлена.

---

## 12) Примечания по контенту (Markdown)
- Контент лекций хранится в Markdown.
- Заголовки (`##`, `###`) формируют TOC.
- Кодовые блоки должны иметь язык (```ts, ```bash и т.п.) для подсветки.


---

## 13) Хранение контента в репозитории (опционально)

Помимо хранения в БД, часть или весь контент лекций можно хранить **файлами в папке `lectures/`** (удобно для git-версий, ревью и простого деплоя контента).

### 13.1 Структура папок
- `lectures/<subject>/...`
  - `<subject>` — наименование предмета (например: `typescript`, `javascript`, `react`).

Пример:
- `lectures/typescript/`
- `lectures/react/`

### 13.2 Именование файлов
Рекомендуемый шаблон:
- **Лекция:** `<subject>-<NN>.md`
- **Выжимка/шпаргалка:** `<subject>-<NN>-cheatsheet.md` или `<subject>-<NN>-summary.md`

Где:
- `<NN>` — порядковый номер лекции (желательно с ведущим нулём: `01`, `02`, ...)

Примеры:
- `lectures/typescript/typescript-01.md`
- `lectures/typescript/typescript-01-cheatsheet.md`
- `lectures/typescript/typescript-02.md`
- `lectures/typescript/typescript-02-summary.md`

### 13.3 Метаданные (front matter)
Чтобы не дублировать данные в БД, можно добавлять YAML front matter в начале файла:

```yaml
---
course: "TypeScript"
module: "Basics"
lecture: 1
title: "Types, any/unknown, unions"
sourceType: "text"
videoUrl: null
tags: ["typescript", "types"]
---
```

> В UI и API это маппится на сущности `Course/Module/Lecture/LectureSection`. Разделы можно хранить либо как заголовки внутри одного файла, либо отдельными файлами (если контент очень большой).

### 13.4 Парсинг в разделы
- Заголовки `##` / `###` формируют `LectureSection` и TOC.
- Для видео можно хранить таймкоды в тексте (например `00:12:34`) или в front matter/sidecar-файле (`.json`), чтобы собирать `startTimeSec`.
